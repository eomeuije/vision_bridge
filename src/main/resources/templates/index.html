<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vision Bridge</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="/styles.css" rel="stylesheet">
</head>
<body>
<!-- 로고, 제목, 사용법 버튼 영역 -->
<div class="header d-flex align-items-center justify-content-between">
    <!-- 로고 영역 (탭 순서 제외) -->
    <div class="logo" aria-hidden="true">
        <i class="fa-solid fa-eye logo-icon"></i>
    </div>

    <!-- 제목 영역 (가운데 배치) -->
    <h1 id="mainTitle" tabindex="1">Vision Bridge</h1>

    <!-- 사용법 버튼 영역 (오른쪽 배치) -->
    <button id="helpButton" class="btn help-button" aria-label="Vision Bridge 사용법 보기" tabindex="2">
        <i class="fa-regular fa-circle-question"></i> 사용법
    </button>
</div>

<!-- 입출력 영역 -->
<div class="container">
    <div class="translator-container">
        <!-- 텍스트 입력 영역 -->
        <div class="translator-area">
            <h4>
                <span class="lang-toggle active" id="brailleTab" role="tab" aria-selected="true" aria-controls="inputText" tabindex="3">점자</span>
                <span class="lang-toggle" id="textTab" role="tab" aria-selected="false" aria-controls="inputText" tabindex="4">비점자</span>
            </h4>
            <textarea id="inputText" class="form-control" rows="7" placeholder="점자를 입력하세요. 또는 문서/이미지를 드래그 앤 드롭하세요." aria-label="번역 입력창" tabindex="5"></textarea>

            <!-- 이미지 업로드, 문서 업로드 버튼들 -->
            <div class="file-upload">
                <button class="btn btn-secondary" aria-label="이미지 파일 업로드" onclick="document.getElementById('imageUpload').click()" tabindex="10">
                    <i class="fa-regular fa-image"></i> 이미지 업로드
                </button>
                <input type="file" id="imageUpload" style="display: none;">

                <button class="btn btn-secondary" aria-label="문서 파일 업로드" onclick="document.getElementById('documentUpload').click()" tabindex="11">
                    <i class="fa-regular fa-folder-open"></i> 문서 업로드
                </button>
                <input type="file" id="documentUpload" style="display: none;">
            </div>
        </div>

        <!-- 양방향 화살표 -->
        <div class="arrow-area">
            <i class="arrow-icon fa-solid fa-arrow-right-arrow-left" id="translateArrow" role="button" aria-label="번역 방향 변경" tabindex="5"></i>
            <button id="translateButton" class="btn btn-primary translate-button" aria-label="번역 실행" tabindex="6">번역</button>
        </div>

        <!-- 텍스트 출력 영역 -->
        <div class="translator-area">
            <h4>
                <span class="lang-toggle" id="brailleToText" role="tab" aria-selected="false" aria-controls="outputText" tabindex="7">점자</span>
                <span class="lang-toggle active" id="textToBraille" role="tab" aria-selected="true" aria-controls="outputText" tabindex="8">비점자</span>
            </h4>
            <textarea id="outputText" class="form-control" rows="7" readonly placeholder="번역 결과가 비점자로 표시됩니다." aria-label="번역 결과창" tabindex="9"></textarea>

            <!-- BRF 다운로드 버튼 -->
            <div class="action-buttons">
                <button id="downloadButton" class="btn btn-outline-secondary" aria-label="BRF 파일 다운로드" tabindex="13">
                    <i class="fa-regular fa-circle-down"></i> BRF 다운로드
                </button>
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.0.11/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script>
    let isBrailleToText = true;

    const brailleTab = document.getElementById('brailleTab');
    const textTab = document.getElementById('textTab');
    const inputText = document.getElementById('inputText');
    const outputText = document.getElementById('outputText');
    const translateArrow = document.getElementById('translateArrow');

    // 번역 방향 변경 (클릭 및 엔터 키)
    translateArrow.addEventListener('click', function () {
        isBrailleToText = !isBrailleToText;

        // 입력 영역 탭 활성화 및 색상 변경
        brailleTab.classList.toggle('active', isBrailleToText);
        textTab.classList.toggle('active', !isBrailleToText);
        brailleTab.setAttribute('aria-selected', isBrailleToText);
        textTab.setAttribute('aria-selected', !isBrailleToText);

        // 출력 영역 탭 활성화 및 색상 변경
        const brailleToText = document.getElementById('brailleToText');
        const textToBraille = document.getElementById('textToBraille');
        brailleToText.classList.toggle('active', !isBrailleToText);
        textToBraille.classList.toggle('active', isBrailleToText);
        brailleToText.setAttribute('aria-selected', !isBrailleToText);
        textToBraille.setAttribute('aria-selected', isBrailleToText);

        // 입력 및 출력 플레이스홀더 전환
        inputText.placeholder = isBrailleToText
            ? "점자를 입력하세요. 또는 문서/이미지를 드래그 앤 드롭하세요."
            : "비점자를 입력하세요. 또는 문서/이미지를 드래그 앤 드롭하세요.";
        outputText.placeholder = isBrailleToText
            ? "번역 결과가 비점자로 표시됩니다."
            : "번역 결과가 점자로 표시됩니다.";

        // 입력 및 출력 값 초기화
        inputText.value = '';
        outputText.value = '';
    });

    // 엔터 키로 번역 방향 변경
    translateArrow.addEventListener('keydown', function (event) {
        if (event.key === 'Enter') {
            event.preventDefault(); // 기본 동작 방지
            this.click(); // 클릭 이벤트 트리거
        }
    });

    // BRF 다운로드 버튼
    document.getElementById('downloadButton').addEventListener('click', function () {
        const content = outputText.value;
        if (!content) {
            alert('다운로드할 내용이 없습니다.');
            return;
        }
        const blob = new Blob([content], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'translated.brf';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    });

    // 사용법 버튼
    document.getElementById('helpButton').addEventListener('click', function () {
        window.open('/help', '_blank', 'width=600,height=400');
    });

    // 이미지 업로드
    document.getElementById('imageUpload').addEventListener('change', function (event) {
        const file = event.target.files[0];
        if (file) {
            alert(`이미지 파일 선택: ${file.name}`);
        }
    });

    // 문서 업로드
    document.getElementById('documentUpload').addEventListener('change', function (event) {
        const file = event.target.files[0];
        if (file) {
            alert(`문서 파일 선택: ${file.name}`);
        }
    });

    document.getElementById('translateButton').addEventListener('click', function () {
        const sourceText = inputText.value;

        fetch('/api/translate', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ sourceText })
        })
            .then(response => {
                if (!response.ok) {
                    return response.text().then(errorMessage => {
                        throw new Error(`서버 오류: ${errorMessage}`);
                    });
                }
                return response.text();
            })
            .then(data => {
                outputText.value = data;
            })
            .catch(error => {
                console.error('Error:', error.message);
                alert('번역 요청 중 문제가 발생했습니다.');
            });
    });
</script>
</body>
</html>
